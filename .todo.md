# buglist
- [x] 角色死后行动力的条不要再抖动
- [x] disable的选项要可以Select但是不能Confirm.现在是不能Select也不能Confirm
- [x] 角色卡片展开后出现不应该存在的空白
- [x] 没有武器也能刺
- [x] 选择上前交涉时，玩家的行动应该设置成最大值一半
- [ ] 角色卡片展开后右腿被cull掉了
- [x] AI不应该扔掉装备
- [x] 贵族兵扔掉装备后未找到可用的行动，至少能冲撞，应该先过滤掉无可用行动的身体部位
- [x] 剧情Ethan穿上旧盔甲有误，应该去掉，只要拿上长剑即可
- [x] 丢武器不需要“准备丢掉武器”的提示，丢弃应几乎立即完成
- [x] 选择身体部位后选择行动时，第一行需要显示具体伤害数值
- [ ] 敌人死完了战斗没有结束

# 待办

## 工具链
- [ ] 增加一键将任意图片转换为屏幕分辨率且符合FC配色的工具

## 对话框系统
- [x] 菜单支持翻页
- [x] GenericDialogue也需要支持MCP
- [x] GenericDialogue的选项应该靠左,靠上
- [x] 第一章穿好装备返回，需要点触发后才出后续剧情
- [x] MenuOptionList选项用RichTextLabel支持BBCode并隐藏滚动自适应

## 背景系统
- [ ] 增加显示/隐藏背景图片的系统

## 战斗系统
- [x] await 战斗可以得到bool值: 胜利/失败
- [ ] 增加战斗中的教程
- [x] AI更随机
- [x] 只有一个敌人时跳过选择敌人的过程
- [ ] 选择目标时hover的目标角色卡片应该展开
- [ ] 装备越重,行动力增长越慢

## 身体部位血量系统
- [x] BodyPart增加public readonly BodyPartCode id 字段
- [x] 定义ICombatTarget接口并为角色、身体部位提供实现
- [x] 改造玩家与AI攻击决策流程以选择ICombatTarget
- [x] 需要可以返回的MenuDialogue.CreateDialogue增加参数,是否可以Esc返回.
- [x] 有esc时,自动追加选项"返回"
- [x] 选择返回或者esc会await得到对应下标
- [x] 攻击目标的身体部位菜单支持返回
- [x] 攻击选择目标角色的菜单需要支持返回
- [x] 在Combat结算中使用部位血量并同步日志与动画
- [x] 以头部或躯干血量归零作为死亡判定来源
- [x] 移除角色全局 `HP` 字段
- [x] 调整 `CharacterNode` 血量展示为头部/躯干最低百分比
- [x] 巡检UI与战斗流程确保不再出现旧 `HP` 引用
- [x] CharacterNode需要能够展开
- [x] CharacterNode增加Expanded属性
- [x] 增加每个身体部位的血条
- [x] 展开后隐藏Overview
- [x] CharacterNode在攻击/受击时展开
- [ ] 血条改为分数。不同部位用不同的最大血量
- [x] 身体部位增加腹股沟

## 装备系统
- [x] 定义装备类型enum(mask)
- [x] 定义装备类,实现ICombatTarget
- [x] 定义装备槽接口.装备槽可以放装备(可能嵌套)
- [x] 初始角色直接装备一把剑用来测试
- [x] 选择攻击目标时可以选择敌人手上的武器
- [x] 定义物品栏
- [x] 实现装备交互
- [x] 战斗中可以抽出装备在皮带上的武器
- [x] 没有装备槽的部位不应该出现在装备菜单里
- [x] 装备槽的desc需要显示可以放入物品的类型
- [x] 装备的desc第一行显示他的flag,第二行才显示其他属性
- [x] 穿装备时,位置不匹配的装备不要出现
- [x] 物品槽需要引用他的Container
- [x] 进入战斗时物品需要记住它属于哪个槽.退出战斗时,如果槽从属的Container还在人身上,那么就回到这个槽
- [x] 角色的手臂第0槽为护甲,第1槽为武器且装备菜单隐藏武器槽(只能战斗中拿出)
- [x] 剧情选项可以提前拿出武器
- [x] 定义装备属性
- [ ] 接入excel
- [x] 优化槽位显示 `槽位1: 板甲` -> `#板甲` `槽位2: 空` -> `#空`
- [x] 队伍中只有一个人时,查看装备不要选择角色了
- [x] 简化装备(去掉内层,中层,外层.合并为躯干护甲)
- [x] 增加棉裤,链甲裤(换个好听的名字吧),板甲护腿. 增加装备掩码: 裤子(换个好听的名字吧但是我想不到),护腿
- [x] 装备菜单选择身体部位名应该带有装备.例如`右臂[护手][长剑]`
- [x] 装备菜单选择装备槽时,装备槽上有装备且装备上有装备,应该显示装备上的装备
- [x] ItemConfig定义时使用Story字段, Description展示关键数值(武器伤害/护甲防护等)+Story
- [x] 开局物品改为长剑、绵甲、棉裤、皮带，绵甲棉裤皮带开局即穿戴，首个任务改成只要求装备长剑
- [x] 打开装备菜单时标题改为“查看装备”
- [x] 查看装备的各级菜单标题使用导航格式，例如`躯干>皮带`
- [x] 移除"丢弃"行动
- [ ] 定义护甲的覆盖率。这会影响到武器打在肉上还是护甲上

## 动作系统
- [x] 抓不应该播报伤害,但是要播报buff
- [x] 选择攻击方身体部位或防守方身体部位时,选项名应该带有装备.例如`右臂[护手][长剑]`
- [x] 身体部位选项的装备展示改为bbcode格式,例如躯干[icon=xxxx]
- [x] 新增抓和被抓的部位的行动
- [x] 为每个动作分配ID并为每个角色指定可用动作列表
- [x] 需要更详细的动作说明
- [x] 攻击动作区分前摇后摇,基类参数在动作类中填入
- [x] 行动菜单标题使用导航格式，例如`Ethan的回合`,`Ethan的左臂`,`Ethan的左臂斩击`,`Ethan的左臂斩击Dove的`
- [ ] 行动的desc不要显示伤害倍率
- [x] 需要可以捡起地上的武器
- [ ] 捡起武器的前后摇太短了，需要加长
- [ ] 增加测试选项,处决.用手发动,选择敌人任意部位,直接让对应部位生命值归零

## 反应系统
- [x] 每回合反应变为1
- [x] CharacterNode需要绘制反应
- [x] 即将遭受攻击时可以选择格挡,闪避,承受
- [x] 格挡消耗1个反应选择一个自己的ICombatTarget进行格挡
- [x] 闪避消耗1个反应进行闪避会打断自己的行动
- [x] 承受即什么也不做
- [x] 定义攻击动作的格挡成功率
- [x] 定义攻击动作的闪避成功率
- [x] 战斗开始时所有角色的反应点数应清零
- [x] 刺击应该更容易被闪避,更难被格挡
- [ ] 战斗开始时行动力计算有问题, 上前交涉还能先手, 待查
- [x] 裆部和躯干应该由格挡成功率加成
- [x] 反应会打断自己的动作
- [x] 玩家选择反应时,菜单的标题应该是"应对xxx对xxx的xxx",例如"应对贵族兵长剑对Ethan头部的斩击"
- [ ] 玩家选择反应时,应该展示每个动作的格挡率和闪避率
- [x] 反应的结果不要显示成功率
- [ ] 反应点数不够时,选项应该变灰
 - [x] AI应该有概率不反应

## 音乐
- [ ] 增加战斗bgm
- [ ] 增加剧情bgm

## buff系统
- [x] 定义Buff类和BuffCode
- [x] 定义IBuffOwner接口
- [x] 装备实现IBuffOwner
- [x] 身体部位实现IBuffOwner
- [x] 实现抓住buff

## jucy
- [x] 人物受击时身体部位的血条闪一下红色
- [ ] 身体部位的血条要缓慢变化

## 存档
- [x] 游戏需要引用玩家方的角色对象而不是每次战斗重新创建
- [x] 游戏菜单增加存档选项
- [x] 主菜单开始新游戏需要选择一个存档槽
- [x] 主菜单增加读档选项
- [x] 存档槽显示snapshot
- [x] snapshot记录版本号和时间
- [x] 存档槽显示snapshot时间，desc显示版本号

# 最美角落

## 武器卡住

Ethan的短剑精准刺入了Dove胸甲缝隙!
Dove死了
Ethan的短剑卡在Dove的胸甲缝隙里拔不出来
Ethan尝试用力拔出短剑

## 武器断裂

Ethan的斩击
Dove用钉头锤挡住了Ethan的斩击
Ethan的长剑断了!

## 面罩

Ethan束缚住了Jack!
Dove掀开了Jack的面罩!
Dove用匕首刺进Jack的眼球!

## 流血

角色卡片有流血动画

# 悬而未决
