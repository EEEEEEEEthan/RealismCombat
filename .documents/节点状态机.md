# 节点状态机

## 设计理念

节点自身不处理业务逻辑，而是通过内部状态机来管理所有功能。

## 架构模式

### 职责分离
- **节点 (Node)**: 仅作为容器，持有状态机引用和基础数据
- **状态机 (State)**: 处理所有实际的业务逻辑和交互

### 状态转换
状态对象在构造函数中执行初始化逻辑，通过创建新状态对象来实现状态转换。

### 状态恢复
状态机支持从持久化数据中恢复，通过工厂方法根据保存的状态ID创建对应的状态实例。

## 实现示例

参考文件：
- `Scripts/Nodes/ProgramRootNode.cs` - 程序根节点状态管理
- `Scripts/Nodes/GameNode.cs` - 游戏节点状态管理

```
ProgramRootNode (程序根节点)
  └── State (抽象状态机)
       ├── IdleState (主菜单状态)
       └── GameState (游戏运行状态)

GameNode (游戏节点)
  └── State (抽象状态机)
       ├── IdleState (游戏菜单状态)
       └── CombatState (战斗状态)
```

每个状态类持有对宿主节点的引用，通过节点访问共享数据和其他系统。

