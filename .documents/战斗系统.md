# 战斗系统

## 概述
战斗系统采用回合制，通过行动力系统控制角色行动顺序。战斗行动在执行前必须通过模拟验证。

## 核心概念

### 行动模拟验证
位于 `Scripts/Nodes/CombatNode.cs` 的 `ActionSimulate` 类

**职责：**
- 在执行战斗行动前验证行动的有效性
- 计算行动造成的伤害和消耗的行动力
- 检查攻击者、防御者、身体部位的有效性

**验证规则：**
- 攻击者身体部位必须可用（HP > 0）
- 防御者必须是敌方且存活
- 防御者身体部位必须可用（HP > 0）

**返回结果：**
- `SimulateResult` 包含伤害值和行动力消耗值
- 战斗执行时使用模拟返回的值，确保计算一致性

### 战斗状态机
战斗节点使用状态机管理战斗流程：
- `RoundInProgressState` - 回合进行中，恢复行动力
- `CharacterTurnState` - 角色回合，玩家选择行动或AI自动行动
- `CharacterTurnActionState` - 执行行动，包含模拟验证和执行逻辑

参考文件：
- `Scripts/Nodes/CombatNode.cs`

