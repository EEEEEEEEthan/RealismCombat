# 调试工具

## 概述
调试工具提供了一组用于检查和分析游戏运行时状态的指令，帮助开发和测试过程中诊断问题。

## show_node_tree

### 功能
以JSON格式递归显示Godot节点树的层级结构，展示每个节点的名称和类型。

### 实现
位于 `Scripts/Nodes/ProgramRootNode.cs` 中的 `BuildNodeTree` 方法

### 输出格式
JSON风格的嵌套结构，格式为 `"节点名(节点类型)"`：

```json
"ProgramRootNode(ProgramRootNode)": {
  "Dialogues(MarginContainer)": {
    "MenuDialogue(MenuDialogue)": {
      "VBoxContainer(VBoxContainer)": {
        "Title(Control)": {
          "PrinterLabel(PrinterLabelNode)"
        },
        "Options(VBoxContainer)": {
          "Label(Label)",
          "Label(Label)"
        }
      }
    }
  }
}
```

### 使用场景
1. **检查场景结构**：验证节点是否正确创建和销毁
2. **调试节点层级**：确认父子关系是否符合预期
3. **监控状态变化**：在不同游戏状态下查看节点树的变化
4. **定位节点路径**：找到特定节点在树中的位置

### 技术细节
- 使用递归遍历算法深度优先访问节点树
- 通过 `Node.GetChildCount()` 和 `Node.GetChild(i)` 获取子节点
- 使用 `StringBuilder` 构建输出，避免频繁字符串拼接
- 根据层级自动缩进（每层4个空格），提高可读性
- 叶子节点不显示大括号，有子节点的节点显示大括号包围的子节点列表

### MCP集成
- 通过 `show_node_tree` 命令调用
- 从根节点 `ProgramRootNode` 开始遍历整个节点树
- 执行完毕后调用 `McpRespond()` 返回结果
