# 调试工具

## 概述
调试工具提供了一组用于检查和分析游戏运行时状态的指令，帮助开发和测试过程中诊断问题。

## debug_show_node_tree

### 功能
以JSON格式递归显示Godot节点树的层级结构，展示每个节点的名称和类型。

### 实现
位于 `Scripts/Commands/DebugShowNodeTreeCommand.cs`

### 参数
- `root`: 起始节点路径（默认值: `/root`）
  - 支持任何有效的节点路径
  - 例如: `/root/GameRoot`, `/root/GameRoot/PrepareCanvas`

### 输出格式
JSON风格的嵌套结构，格式为 `"节点名(节点类型)"`：

```json
"root(Window)": {
  "GameRoot(GameRoot)": {
    "PrepareCanvas(BattlePrepareScene)": {
      "ButtonNextCombat(Button)"
    }
  }
}
```

### 使用场景
1. **检查场景结构**：验证节点是否正确创建和销毁
2. **调试节点层级**：确认父子关系是否符合预期
3. **监控状态变化**：在不同游戏状态下查看节点树的变化
4. **定位节点路径**：找到特定节点在树中的位置

### 示例
```
# 显示完整节点树
debug_show_node_tree

# 显示GameRoot及其子节点
debug_show_node_tree root /root/GameRoot

# 显示特定场景的节点
debug_show_node_tree root /root/GameRoot/PrepareCanvas
```

### 技术细节
- 使用递归遍历算法深度优先访问节点树
- 通过`Node.GetChildCount()`和`Node.GetChild(i)`获取子节点
- 使用`StringBuilder`构建输出，避免频繁字符串拼接
- 根据层级自动缩进，提高可读性
- 如果指定的根节点不存在，会输出错误信息

### 实现要点
**参数解析**：
- 从`arguments`字典中获取`root`参数
- 使用`GetValueOrDefault`提供默认值`/root`

**节点遍历**：
- 递归函数`BuildNodeTreeRecursive`处理每个节点
- 每层缩进增加2个空格
- 叶子节点和有子节点的节点格式不同

**错误处理**：
- 验证节点路径有效性
- 无效路径时输出错误并正常结束命令

**MCP集成**：
- 在所有游戏状态中都可用
- 执行完毕后调用`McpCheckPoint()`返回结果

