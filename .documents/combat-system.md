# 战斗系统

## 战斗循环

- 战斗开始时弹出通用对话框提示“战斗开始了”，之后进入循环。
- 每个循环 tick 之前都会进行胜负判定；若任一方成员全部死亡，则立即结束战斗并输出胜利/失败日志。
- 循环内持续获取行动条达到上限的角色执行行动；每次行动后再次判定胜负。
- 当一轮行动结束后，只为仍然存活的角色补充行动点（按速度属性叠加）。
- 若战斗持续 32 个 tick 仍未结束，判定玩家胜利（敌人逃走）。

## 行动决策

- `CombatInput` 以 `Combat` 实例作为构造参数，直接读取 `Allies` 与 `Enemies`。
- 玩家输入：
  - 首先选择“攻击”行为；
  - 若敌方仅剩一名存活目标，则自动锁定；
  - 若存在多名敌人，弹出目标列表（显示名称与当前生命），玩家选择后执行。
- AI 输入：
  - 随机选择一名仍存活的敌人；
  - 若无存活目标，直接返回空目标的攻击（不执行动作）。

## 角色与属性

- `Character` 新增 `IsAlive` 辅助属性，当 `hp.value > 0` 时为存活。
- 攻击造成的伤害为 1-3 点随机值：
  - 伤害计算使用 `GD.Randi()`，对 3 取模后 +1；
  - 更新血量时将结果夹在 `[0, maxValue]` 范围内；
  - 被击倒的目标会输出倒下提示。
- 行动点 (`actionPoint`) 在执行攻击后扣除 5 点，不允许出现负值。

## 战斗入口

- `Game` 中选择“开始战斗”时，会实例化 `Combat` 并添加为子节点，等待其完成。
- `Combat` 对外暴露只读的 `Allies`、`Enemies` 以供输入逻辑访问。


