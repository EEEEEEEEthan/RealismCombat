# 物品系统

## 概述
物品系统支持角色的装备管理和物品的嵌套存储。

## 核心概念

### 物品槽
物品可以存储在两种类型的槽位中：

#### 身体部位物品槽
每个身体部位（头部、躯干、左臂、右臂、左腿、右腿）都有一个物品槽，可以放置一个物品。

位于 `Scripts/Data/CharacterData.cs` 的 `BodyPartData` 类

#### 物品内部物品槽
物品本身也可以有物品槽，用于存储其他物品。物品槽的数量由物品配置决定。

位于 `Scripts/Data/ItemData.cs` 的 `ItemData` 类

**物品槽容量配置：**
- 每个物品的物品槽容量在 `ItemConfig.slotCapacity` 中配置
- 物品槽数组长度始终等于配置的容量
- 槽位可以为空（`null`），表示该槽位未放置物品

**数据结构：**
- `ItemData.slots` 是 `ItemData?[]` 类型数组
- 数组长度等于 `ItemConfig.slotCapacity`
- 数组元素可以为 `null`（空槽位）

### 装备菜单系统

装备菜单系统提供用户界面来管理角色的装备。

#### 菜单层级结构
1. **装备主菜单**：显示所有身体部位，有装备的部位显示为"部位[装备名字]"
2. **空槽菜单**：点击空槽显示物品列表，选择物品进行装备
3. **装备槽位菜单**：点击有装备的槽显示装备的槽位列表，支持递归嵌套

#### 槽位显示规则
- 空槽位显示为"槽位N(空)"
- 有装备的槽位显示为"槽位N[装备名字]"

#### 物品堆叠机制
- 当物品被卸下放回物品栏时，系统会检查是否存在相同类型的物品可以堆叠
- 堆叠条件：
  - 两个物品的 `itemId` 必须相同
  - 两个物品的 `slots` 数组长度必须相同
  - 两个物品的所有槽位都必须为空（`null`）
- 如果满足堆叠条件，物品的 `count` 会增加；否则作为新物品添加到物品栏
- 如果物品有非空槽位，无法堆叠，会作为独立物品添加

#### 卸下规则
- 只有当装备的所有槽位都为空时，才显示"卸下"按钮
- 如果装备存在非空槽位，不允许卸下（防止装备丢失）
- 卸下时会自动进行堆叠检查

#### 菜单显示规则
- 所有菜单中显示物品时使用物品名字（`ItemConfig.name`）而不是物品ID
- 如果物品ID未在配置中找到，则显示为"物品{ID}"

#### 递归嵌套
装备上的槽位可以继续装备其他物品，形成多层级嵌套结构。每个层级都遵循相同的菜单规则。

参考文件：
- `Scripts/Data/ItemData.cs`
- `Scripts/Data/CharacterData.cs`
- `Scripts/Nodes/GameNode.cs`


